# 								配置交换机多生成树

1、配置交换机的vlan和端口属性

switch-1

```c
[Huawei]sysname sw1					//修改交换机名称
<sw1>undo terminal monitor 				//关闭泛洪信息
Info: Current terminal monitor is off.
<sw1>system-view 						//进入特权模式
[sw1]undo info-center enable 			//关闭信息中心
Info: Information center is disabled.
[sw1]vlan batch 10 20					//创建多个vlan
[sw1]interface GigabitEthernet 0/0/3			//进入端口模式
[sw1-GigabitEthernet0/0/3]port link-type access		//配置端口属性
[sw1-GigabitEthernet0/0/3]port default vlan 10		//绑定vlan
[sw1]interface GigabitEthernet 0/0/2				//进入端口模式
[sw1-GigabitEthernet0/0/2]port link-type trunk		//配置端口属性
[sw1-GigabitEthernet0/0/2]port trunk allow-pass vlan all	//通过所有vlan
[sw1-GigabitEthernet0/0/2]q
[sw1]interface GigabitEthernet 0/0/1						//进入端口模式
[sw1-GigabitEthernet0/0/1]port link-type trunk				//配置端口属性
[sw1-GigabitEthernet0/0/1]port trunk allow-pass vlan all		//通过所有vlan
[sw1-GigabitEthernet0/0/1]q
```

switch-2

```c
<Huawei>undo terminal monitor 					//关闭泛洪信息
Info: Current terminal monitor is off.				
<Huawei>system-view 						//进入特权模式
[Huawei]sysname sw2							//配置交换机名称
[sw2]vlan batch 10 2						//创建多个vlan
[sw2]interface GigabitEthernet 0/0/3			//进入端口模式
[sw2-GigabitEthernet0/0/3]port link-type access		//配置端口模式
[sw2-GigabitEthernet0/0/3]port default vlan 20			//绑定vlan
[sw2-GigabitEthernet0/0/3]q
[sw2]interface GigabitEthernet 0/0/1				//进入端口模式
[sw2-GigabitEthernet0/0/1]port link-type trunk		//配置端口模式
[sw2-GigabitEthernet0/0/1]port trunk allow-pass vlan all   //允许所有vlan通过
[sw2-GigabitEthernet0/0/1]q
[sw2-GigabitEthernet0/0/2]port link-type trunk
[sw2-GigabitEthernet0/0/2]port trunk allow-pass vlan all
[sw2-GigabitEthernet0/0/2]q
```

switch-3

```c
<Huawei>undo terminal monitor 			//关闭泛洪信息
<Huawei>system-view						//进入特权模式
[Huawei]sysname sw3
[sw3]vlan batch 10 20					//创建多个vlan
[sw3]interface GigabitEthernet 0/0/3		//进入端口模式
[sw3-GigabitEthernet0/0/3]port link-type access			//配置端口模式
[sw3-GigabitEthernet0/0/3]port default vlan 10			//绑定vlan
[sw3-GigabitEthernet0/0/3]q
[sw3]interface GigabitEthernet 0/0/4				//进入端口模式
[sw3-GigabitEthernet0/0/4]port link-type access		//配置端口模式
[sw3-GigabitEthernet0/0/4]port default vlan 20		//绑定vlan
[sw3-GigabitEthernet0/0/4]q
[sw3]interface GigabitEthernet 0/0/1			//进入端口模式
[sw3-GigabitEthernet0/0/1]port link-type trunk		//配置端口模式
[sw3-GigabitEthernet0/0/1]port trunk allow-pass vlan all    //允许所有vlan通过
[sw3-GigabitEthernet0/0/1]q
[sw3]interface GigabitEthernet 0/0/2
[sw3-GigabitEthernet0/0/2]port link-type trunk
[sw3-GigabitEthernet0/0/2]port trunk allow-pass vlan all
[sw3-GigabitEthernet0/0/2]q
```

2、配置MSTP协议

查看当前根交换机

![image-20221115231832677](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221115231832677.png)



查看端口阻塞，分析数据流向

![image-20221115232345980](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20221115232345980.png)

给三台交换机添加配置

```c
[sw1]stp region-configuration 
[sw1-mst-region]reg	
[sw1-mst-region]region-name xiaomeng      //xiaomeng起一个名称
[sw1-mst-region]instance 1 vlan 10			//一个实例里面，可以有多个vlan
[sw1-mst-region]instance 2 vlan 20
[sw1-mst-region]active region-configuration    //激活上面的配置，否则不生效
Info: This operation may take a few seconds. Please wait for a moment...done.
[sw1-mst-region]
```

```c
[sw3-mst-region]dis this
#
stp region-configuration
 region-name xiaomeng
 instance 1 vlan 10
 instance 2 vlan 20
 active region-configuration
#
return
[sw3-mst-region]
```

```c
[sw2-mst-region]dis this
#
stp region-configuration
 region-name xiaomeng
 instance 1 vlan 10
 instance 2 vlan 20
 active region-configuration
#
return
[sw2-mst-region]
```

修改优先级

```c
[sw2]stp instance 1 priority 0
[sw2]dis stp brief
 MSTID  Port                        Role  STP State     Protection
   0    GigabitEthernet0/0/1        ALTE  DISCARDING      NONE
   0    GigabitEthernet0/0/2        ROOT  FORWARDING      NONE
   0    GigabitEthernet0/0/3        DESI  FORWARDING      NONE
   1    GigabitEthernet0/0/1        DESI  FORWARDING      NONE
   1    GigabitEthernet0/0/2        DESI  FORWARDING      NONE
   2    GigabitEthernet0/0/1        ALTE  DISCARDING      NONE
   2    GigabitEthernet0/0/2        ROOT  FORWARDING      NONE
   2    GigabitEthernet0/0/3        DESI  FORWARDING      NONE
[sw2]
```

